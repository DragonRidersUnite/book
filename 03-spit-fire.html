<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spit Fire - Building Games with DragonRuby</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A comprehensive guide to shipping cross-platform 2D games with ease using DragonRuby Game Toolkit.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="01-hello-dragon.html"><strong aria-hidden="true">1.</strong> Hello Dragon!</a></li><li class="chapter-item expanded "><a href="02-player-movement.html"><strong aria-hidden="true">2.</strong> Player Movement</a></li><li class="chapter-item expanded "><a href="03-spit-fire.html" class="active"><strong aria-hidden="true">3.</strong> Spit Fire</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Drawing Shapes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Animations</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Enemies</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Hitboxes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Refactor Break!</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Life &amp; Death</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Basic AI</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Waves of Enemies</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Bullet Patterns</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Scenes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> Boss Fight</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Juice</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">15.1.</strong> Sound Effects</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.2.</strong> Music</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.3.</strong> Screenshake</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.4.</strong> Menus</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.5.</strong> Metadata</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Ship Your Game</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> What Next</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><div>Ruby Primer</div></li><li class="chapter-item expanded affix "><a href="source-control.html">Source Control</a></li><li class="chapter-item expanded affix "><a href="game-dev-resources.html">Game Dev Resources</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Building Games with DragonRuby</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/DragonRidersUnite/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                                        <a href="https://github.com/DragonRidersUnite/book/edit/main/src/03-spit-fire.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="spit-fire"><a class="header" href="#spit-fire">Spit Fire</a></h1>
<p>Our next mission is to make our dragon spit fire because that's just what they do. We'll piece this whole thing into a game with a narrative and intentional design soon enough. But let's keep focusing on simple mechanics and code for right now.</p>
<h2 id="player-refactor"><a class="header" href="#player-refactor">Player Refactor</a></h2>
<p>In the code from the last chapter, there's a lot of code related to the player, from handling their input to moving them, to displaying the sprite. See how we have so much state with the <code>player_</code> prefix? That's a sign we can probably refactor the code to make it a bit easier to manage.</p>
<pre><code class="language-ruby">def tick args
  args.state.player_x ||= 120
  args.state.player_y ||= 280
  speed = 12
  player_w = 100
  player_h = 80

  if args.inputs.left
    args.state.player_x -= speed
  elsif args.inputs.right
    args.state.player_x += speed
  end

  if args.inputs.up
    args.state.player_y += speed
  elsif args.inputs.down
    args.state.player_y -= speed
  end

  if args.state.player_x +  player_w &gt; args.grid.w
    args.state.player_x = args.grid.w - player_w
  end

  if args.state.player_x &lt; 0
    args.state.player_x = 0
  end

  if args.state.player_y + player_h &gt; args.grid.h
    args.state.player_y = args.grid.h - player_h
  end

  if args.state.player_y &lt; 0
    args.state.player_y = 0
  end

  args.outputs.sprites &lt;&lt; [args.state.player_x, args.state.player_y, player_w, player_h, 'sprites/misc/dragon-0.png']
end
</code></pre>
<p>Let's change our <code>app/main.rb</code> to now be this instead:</p>
<pre><code class="language-ruby"># TODO: test this works
class Player
  def initialize
    @x = 120
    @y = 280
    @speed = 12
    @w = 100
    @h = 80
  end

  def tick args
    if args.inputs.left
      @x -= @speed
    elsif args.inputs.right
      @x += @speed
    end

    if args.inputs.up
      @y += @speed
    elsif args.inputs.down
      @y -= @speed
    end

    if @x + @w &gt; args.grid.w
      @x = args.grid.w - @w
    end

    if @x &lt; 0
      @x = 0
    end

    if @y + @h &gt; args.grid.h
      @y = args.grid.h - @h
    end

    if @y &lt; 0
      @y = 0
    end

    args.outputs.sprites &lt;&lt; [@x, @y, @w, @h, 'sprites/misc/dragon-0.png']
  end
end

def tick args
  args.state.player ||= Player.new
  args.state.player.tick args
end
</code></pre>
<p>We've once again changed the code without changing the behavior of the game. This iterative approach to game development and programming is <em>so</em> important. It gives you permission to do something quickly to experiment and then take time to make things better. With this refactor, we've made the code easier to manage and reason about.</p>
<p>The <code>class Player</code> line defines what's known as a class. Many programming languages have classes, and they usually represnet nouns (things) that have properties and can take some actions. Classes have instances, which is one given case of it. You know how there are birds out there in the world? Bird is the concept of the animal--it's a classification (class). But if there was a bird sitting on your head, thats an instance of given bird. And the bird sitting on the powerline across the road watching your every move is another instance of a bird. If we wanted to represent birds in our game, we could define a class:</p>
<pre><code class="language-ruby">class Bird
  def evil?
    true
  end
end
</code></pre>
<p>That lets you create new birds with <code>Bird.new</code> and then check if they are evil (which they always are). For example:</p>
<pre><code class="language-ruby">bird1 = Bird.new
bird1.evil? # =&gt; true
bird2 = Bird.new
bird2.evil? # =&gt; true
</code></pre>
<p>You can have multiple instances of a class. But for our <code>Player</code> dragon, we'll just have one.</p>
<p>The <code>def initialize</code> line defines a method that's called whenever we create a new instance of <code>Player</code>. This is known as the constructor, and it's always called <code>initialize</code> in Ruby. Here you can set variables and write code that gets run once upon creation. The <code>@</code> in front of our variables makes them instance variables--variables that are available within the methods of a class instance (as the name implies). Setting these variables once and referencing them throughout the Player cleans up the code quite a bit.</p>
<p>The <code>tick</code> method that's newly defined does what our global <code>tick</code> method did before, but it contains only what's needed to be managed for the player. As we make our game more complex, encapsulating the code will make it easier to think about and change.</p>
<p>In the global <code>tick</code> method, we create a new player in the <code>args.state.player</code> if there isn't one already. And then every frame we update our player instance.</p>
<pre><code class="language-ruby">def tick args
  args.state.player ||= Player.new
  args.state.player.tick args
end
</code></pre>
<p>We'll be introducing more classes soon enough, so it's great to have one established without actually changing the functionality of the game.</p>
<h2 id="fire-on-input"><a class="header" href="#fire-on-input">Fire on Input</a></h2>
<p>[ displaying a label ]</p>
<h2 id="moving-fireballs"><a class="header" href="#moving-fireballs">Moving Fireballs</a></h2>
<h2 id="placeholder-square"><a class="header" href="#placeholder-square">Placeholder Square</a></h2>
<h2 id="tracking-fireballs"><a class="header" href="#tracking-fireballs">Tracking Fireballs</a></h2>
<h2 id="displaying-a-sprite"><a class="header" href="#displaying-a-sprite">Displaying a Sprite</a></h2>
<h2 id="cleaning-up"><a class="header" href="#cleaning-up">Cleaning Up</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="02-player-movement.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="source-control.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="02-player-movement.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="source-control.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
